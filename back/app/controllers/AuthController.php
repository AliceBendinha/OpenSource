<?php
class AuthController { private $pdo; private $userModel; public function __construct($pdo){ $this->pdo=$pdo; $this->userModel=new UserModel($pdo);} public function login($data){ $email=$data['email']??''; $senha=$data['senha']??''; if(!$email||!$senha){ http_response_code(400); echo json_encode(['error'=>'Email e senha são obrigatórios']); return; } $user=$this->userModel->findByEmail($email); if(!$user||!password_verify($senha,$user['senha'])){ http_response_code(401); echo json_encode(['error'=>'Credenciais inválidas']); return; } session_regenerate_id(true); $_SESSION['user']=['id'=>$user['id'],'nome'=>$user['nome'],'email'=>$user['email'],'role'=>$user['role']]; echo json_encode(['success'=>true,'user'=>$_SESSION['user']]); } public function logout(){ session_destroy(); echo json_encode(['success'=>true]); } }
